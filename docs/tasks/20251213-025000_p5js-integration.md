# タスク: p5.js の導入

**作成日時**: 2025-12-13 02:50:00 (JST)
**完了日時**: 2025-12-13 03:06:00 (JST)
**ステータス**: ✅ 完了

## ゴール

水槽コンテンツに p5.js を使ったスケッチを導入できるようにし、「Water Controller」というテキストを表示するサンプルを作成する。

## 背景・動機

Three.js に続いて、p5.js も使えるようにすることで、より多様なビジュアル表現が可能になる。p5.js は：

- Processing ベースの JavaScript ライブラリ
- クリエイティブコーディングに特化
- シンプルな API で初心者にも扱いやすい
- 豊富なサンプルとコミュニティ

## 参考資料

- [React で p5.js を使う方法](https://qiita.com/skm_bnn/items/e00f8b4b97a32544d913#p5js%E3%81%AE%E5%B0%8E%E5%85%A5)
- [p5.js 公式サイト](https://p5js.org/)
- [目標サンプル: テキストアニメーション](https://p5js.org/sketches/2689119/)

## タスク一覧

### 1. p5.js 関連パッケージのインストール

- [x] `p5` パッケージのインストール
- [x] `@types/p5` のインストール（TypeScript 型定義）
- [x] `@p5-wrapper/react` のインストール（React と p5.js の統合）※ react-p5 は非推奨のため代替

### 2. p5.js コンテンツのサンプル作成

- [x] "Water Controller" テキストアニメーションを作成
- [x] Content 型に適合させる
- [x] contents/ ディレクトリに配置

### 3. コンテンツの登録

- [x] contents/index.ts に export を追加
- [x] utils.ts に追加
- [x] lib/constants/contents.ts に追加

### 4. 動作確認

- [x] 型チェックが通ることを確認
- [ ] アプリを起動してサンプルが表示されることを確認
- [ ] ボタン入力でコンテンツ切り替えができることを確認
- [ ] Canvas 2D / Three.js / p5.js が混在したプレイリストで動作確認

### 5. ドキュメント更新

- [x] PLAYLIST.md に p5.js パターンを追加
- [x] タスクドキュメントを完了状態に更新

## 技術的な詳細

### p5.js とは

p5.js は Processing をベースにした JavaScript ライブラリ：

- **setup() / draw()**: Processing と同じ構造
- **Canvas API のラッパー**: より直感的な描画 API
- **インタラクティブ**: マウス、キーボード、タッチ対応
- **豊富な機能**: 図形、色、テキスト、画像、サウンドなど

### react-p5 とは

p5.js を React コンポーネントとして扱えるようにするライブラリ：

- `<Sketch>` コンポーネントで p5.js スケッチを実行
- setup, draw などの関数を props として渡す
- React のライフサイクルと統合

### 実装方針

Three.js と同様に、`Content` 型の `component` フィールドを使用：

```tsx
import Sketch from 'react-p5'
import type p5 from 'p5'

function WaterControllerText({ width, height }: ContentComponentProps) {
  const setup = (p5: p5, canvasParentRef: Element) => {
    p5.createCanvas(width, height).parent(canvasParentRef)
  }

  const draw = (p5: p5) => {
    // "Water Controller" を描画
  }

  return <Sketch setup={setup} draw={draw} />
}

export const waterControllerText: Content = {
  metadata: {
    id: 'water-controller-text',
    name: 'Water Controller Text',
    description: 'p5.js で "Water Controller" を表示'
  },
  component: WaterControllerText
}
```

### 目標サンプルの実装

https://p5js.org/sketches/2689119/ の実装内容：

- "Water Controller" というテキストを画面に表示
- アニメーション効果を追加
- p5.js の text() 関数を使用

## 制約・注意事項

- 既存の Canvas 2D / Three.js コンテンツとの互換性を保つ
- p5.js のグローバルモード（window.setup など）は使わない
- インスタンスモードで実装

## 完了条件

- [x] p5.js を使った "Water Controller" テキストのコードが実装されている
- [x] Content 型に適合している
- [x] コンテンツが正しく登録されている
- [x] ドキュメントが更新されている
- [ ] 実機での動作確認が完了している（ユーザーによる確認待ち）

## メモ・その他

### 実装の詳細

1. **パッケージの選定**
   - `react-p5` は非推奨（deprecated）だったため、`@p5-wrapper/react` を使用
   - インストールしたパッケージ:
     - `p5@2.1.1`
     - `@p5-wrapper/react@4.4.2`
     - `@types/p5@1.7.7`

2. **実装パターン**
   - p5.js スケッチは `Sketch` 型として定義
   - `ReactP5Wrapper` コンポーネントでラップ
   - Three.js と同様に `Content.component` フィールドを使用

3. **アニメーション内容**
   - "Water Controller" テキストを中央に配置
   - HSB カラーモードで色が変化
   - 回転とスケールのアニメーション
   - 半透明の背景で軌跡を残す効果

4. **ファイル構成**
   - `content5-water-controller-text.tsx`: p5.js コンテンツ実装
   - `contents/index.ts`: export 追加
   - `utils.ts`: allContents マッピング追加
   - `lib/constants/contents.ts`: CONTENT_IDS と CONTENTS 配列に追加
   - `PLAYLIST.md`: p5.js パターンのドキュメント追加

### 次のステップ（ユーザーによる確認）

- [ ] アプリを起動して "Water Controller" テキストが表示されることを確認
- [ ] ボタン入力でコンテンツ切り替えができることを確認
- [ ] Canvas 2D / Three.js / p5.js が混在したプレイリストで動作確認
